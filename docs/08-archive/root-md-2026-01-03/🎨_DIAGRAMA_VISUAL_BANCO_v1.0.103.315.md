# ğŸ¨ DIAGRAMA VISUAL DO BANCO DE DADOS

## ğŸ“Š ARQUITETURA KV STORE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              TABELA ÃšNICA: kv_store_67caf26a                  â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ KEY (PK)    â”‚ VALUE (JSONB)                            â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚ org_xxx     â”‚ {"name": "ImobiliÃ¡ria...", ...}          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ user_yyy    â”‚ {"email": "admin@...", ...}              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ acc_zzz     â”‚ {"name": "Casa...", "photos": [...]}     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ res_aaa     â”‚ {"checkIn": "2025-12-20", ...}           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ ...         â”‚ ...                                      â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUXO DE DADOS: CRIAÃ‡ÃƒO DE IMÃ“VEL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND       â”‚
â”‚  (Wizard Form)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /properties
         â”‚ Body: { contentType: {...}, contentPhotos: {...}, ... }
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      BACKEND                â”‚
â”‚  routes-properties.ts       â”‚
â”‚                             â”‚
â”‚  1. Recebe dados wizard     â”‚
â”‚  2. Chama normalizeWizard() â”‚
â”‚  3. Gera estrutura unificadaâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ kv.set('acc_xxx', {...})
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPABASE KV STORE         â”‚
â”‚                             â”‚
â”‚   KEY: acc_97239cad         â”‚
â”‚   VALUE: {                  â”‚
â”‚     // NORMALIZADO (raiz)   â”‚
â”‚     name: "Casa",           â”‚
â”‚     photos: [...],          â”‚
â”‚     coverPhoto: "url",      â”‚
â”‚                             â”‚
â”‚     // WIZARD (original)    â”‚
â”‚     contentType: {...},     â”‚
â”‚     contentPhotos: {...}    â”‚
â”‚   }                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ESTRUTURA DE UM IMÃ“VEL (Unificado)

```
acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1
â”‚
â”œâ”€â”€ ğŸ“‹ CAMPOS RAIZ (Normalizados - Leitura RÃ¡pida)
â”‚   â”œâ”€â”€ id: "acc_97239cad-..."
â”‚   â”œâ”€â”€ shortId: "H3K9P2"
â”‚   â”œâ”€â”€ organizationId: "org_123..."
â”‚   â”œâ”€â”€ name: "Casa da Praia"                    â† EXTRAÃDO
â”‚   â”œâ”€â”€ photos: [url1, url2, url3]               â† EXTRAÃDO
â”‚   â”œâ”€â”€ coverPhoto: url1                         â† DEFINIDO
â”‚   â”œâ”€â”€ locationAmenities: [...]                 â† EXTRAÃDO
â”‚   â”œâ”€â”€ listingAmenities: [...]                  â† EXTRAÃDO
â”‚   â”œâ”€â”€ address: "Rua..."                        â† EXTRAÃDO
â”‚   â”œâ”€â”€ description: "Linda casa..."             â† EXTRAÃDO
â”‚   â””â”€â”€ rooms: [...]                             â† EXTRAÃDO
â”‚
â”œâ”€â”€ ğŸ“¦ WIZARD STEP 1: contentType
â”‚   â”œâ”€â”€ internalName: "Casa da Praia"
â”‚   â”œâ”€â”€ propertyTypeId: "type_beach_house"
â”‚   â””â”€â”€ category: "residential"
â”‚
â”œâ”€â”€ ğŸ“· WIZARD STEP 2: contentPhotos
â”‚   â””â”€â”€ photos: [
â”‚       { url: "...", isCover: true },
â”‚       { url: "...", isCover: false }
â”‚     ]
â”‚
â”œâ”€â”€ ğŸ“ WIZARD STEP 3: contentLocation
â”‚   â”œâ”€â”€ address: "Rua das Flores, 123"
â”‚   â”œâ”€â”€ city: "FlorianÃ³polis"
â”‚   â”œâ”€â”€ state: "SC"
â”‚   â””â”€â”€ zipCode: "88000-000"
â”‚
â”œâ”€â”€ ğŸ“ WIZARD STEP 4: contentLocationAmenities
â”‚   â””â”€â”€ amenities: ["beach_nearby", "restaurant_nearby"]
â”‚
â”œâ”€â”€ âœ¨ WIZARD STEP 5: contentPropertyAmenities
â”‚   â””â”€â”€ listingAmenities: ["wifi", "pool", "air_conditioning"]
â”‚
â”œâ”€â”€ ğŸ“ WIZARD STEP 6: contentDescription
â”‚   â””â”€â”€ fixedFields: {
â”‚       description: "Linda casa Ã  beira-mar..."
â”‚     }
â”‚
â”œâ”€â”€ ğŸ›ï¸ WIZARD STEP 7: contentRooms
â”‚   â””â”€â”€ rooms: [
â”‚       { type: "bedroom", quantity: 3, beds: [...] },
â”‚       { type: "bathroom", quantity: 2 }
â”‚     ]
â”‚
â”œâ”€â”€ ğŸ’° WIZARD STEP 8: financialIndividualPricing
â”‚   â”œâ”€â”€ basePrice: 500
â”‚   â”œâ”€â”€ weekendPrice: 700
â”‚   â”œâ”€â”€ cleaningFee: 150
â”‚   â””â”€â”€ extraGuestFee: 50
â”‚
â””â”€â”€ âš™ï¸ WIZARD STEP 9: settingsRules
    â”œâ”€â”€ checkInTime: "15:00"
    â”œâ”€â”€ checkOutTime: "11:00"
    â”œâ”€â”€ minNights: 2
    â”œâ”€â”€ maxGuests: 8
    â”œâ”€â”€ petFriendly: true
    â””â”€â”€ smokingAllowed: false
```

---

## ğŸ”— RELACIONAMENTOS ENTRE ENTIDADES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ORGANIZAÃ‡ÃƒO    â”‚ org_123e4567
â”‚  (Multi-Tenant) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ organizationId
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼          â–¼         â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚USUÃRIOSâ”‚ â”‚IMÃ“VEISâ”‚ â”‚RESERVAS â”‚ â”‚GUESTSâ”‚ â”‚OWNERSâ”‚ â”‚SETTINGSâ”‚
â”‚user_xxxâ”‚ â”‚acc_yyyâ”‚ â”‚res_zzz  â”‚ â”‚guest_â”‚ â”‚owner_â”‚ â”‚setting_â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚          â”‚
               â”‚          â”‚ propertyId
               â”‚          â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    IMÃ“VEL       â”‚ acc_97239cad
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ propertyId
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼          â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚RESERVASâ”‚ â”‚BLOCKSâ”‚ â”‚SEASONAL â”‚ â”‚INTEGR.   â”‚ â”‚SITES â”‚
â”‚res_xxx â”‚ â”‚block_â”‚ â”‚seasonal_â”‚ â”‚integrationâ”‚ â”‚site_ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± RELACIONAMENTO WHATSAPP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVOLUTION API   â”‚
â”‚  (Externo)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Webhook
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND RENDIZY            â”‚
â”‚  routes-whatsapp-evolution  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ kv.set()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONVERSAS      â”‚ chat_5511999887766
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ chatId
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MENSAGENS      â”‚ msg_147e4567
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ COMO BUSCAR DADOS (Queries)

### 1ï¸âƒ£ Buscar UM imÃ³vel especÃ­fico
```typescript
const property = await kv.get('acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1');
```

### 2ï¸âƒ£ Buscar TODOS os imÃ³veis
```typescript
const allProperties = await kv.getByPrefix('acc_');
```

### 3ï¸âƒ£ Buscar imÃ³veis de UMA organizaÃ§Ã£o
```typescript
const allProperties = await kv.getByPrefix('acc_');
const orgProperties = allProperties.filter(
  p => p.organizationId === 'org_123e4567'
);
```

### 4ï¸âƒ£ Buscar reservas de UM imÃ³vel
```typescript
const allReservations = await kv.getByPrefix('res_');
const propertyReservations = allReservations.filter(
  r => r.propertyId === 'acc_97239cad'
);
```

### 5ï¸âƒ£ Buscar reservas entre datas
```typescript
const allReservations = await kv.getByPrefix('res_');
const dateReservations = allReservations.filter(r => 
  r.checkIn >= '2025-12-01' && r.checkIn <= '2025-12-31'
);
```

---

## ğŸ’¾ COMO SALVAR DADOS (Mutations)

### 1ï¸âƒ£ Criar imÃ³vel
```typescript
await kv.set('acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1', {
  id: 'acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1',
  shortId: 'H3K9P2',
  organizationId: 'org_123e4567',
  name: 'Casa da Praia',
  photos: ['url1', 'url2'],
  // ... resto dos dados
});
```

### 2ï¸âƒ£ Atualizar imÃ³vel
```typescript
const property = await kv.get('acc_97239cad');
property.name = 'Casa da Praia - Atualizado';
await kv.set('acc_97239cad', property);
```

### 3ï¸âƒ£ Deletar imÃ³vel
```typescript
await kv.del('acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1');
```

### 4ï¸âƒ£ Deletar MÃšLTIPLOS imÃ³veis
```typescript
await kv.mdel([
  'acc_97239cad',
  'acc_12345678',
  'acc_98765432'
]);
```

---

## ğŸ” ISOLAMENTO MULTI-TENANT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TABELA ÃšNICA (FÃ­sica)                      â”‚
â”‚                kv_store_67caf26a                         â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ORGANIZAÃ‡ÃƒO A (org_aaa)                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ acc_001  â”‚ acc_002  â”‚ res_001  â”‚ res_002  â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ORGANIZAÃ‡ÃƒO B (org_bbb)                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ acc_003  â”‚ acc_004  â”‚ res_003  â”‚ res_004  â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ORGANIZAÃ‡ÃƒO C (org_ccc)                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ acc_005  â”‚ acc_006  â”‚ res_005  â”‚ res_006  â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”‘ FILTRO: WHERE organizationId = 'org_xxx'
```

---

## âš¡ PERFORMANCE

### Ãndices AutomÃ¡ticos:
```sql
-- Ãndice primÃ¡rio (automÃ¡tico)
PRIMARY KEY (key)

-- Busca por key: O(1)
SELECT * FROM kv_store_67caf26a WHERE key = 'acc_97239cad';

-- Busca por prefixo: O(log n)
SELECT * FROM kv_store_67caf26a WHERE key LIKE 'acc_%';

-- Busca em JSON: O(n) - mais lento
SELECT * FROM kv_store_67caf26a 
WHERE value->>'organizationId' = 'org_123e4567';
```

### OtimizaÃ§Ãµes:
1. **Sempre buscar por KEY quando possÃ­vel**
2. **Usar getByPrefix() para ranges**
3. **Filtrar no cÃ³digo para campos JSON**
4. **Cachear resultados frequentes**

---

## ğŸ“ˆ ESCALABILIDADE

```
ATUAL:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1 Tabela    â”‚
â”‚  ~250 itens  â”‚
â”‚  <1MB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FUTURO (10.000 imÃ³veis):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1 Tabela    â”‚
â”‚  ~150K itens â”‚
â”‚  ~50MB       â”‚
â”‚              â”‚
â”‚  âœ… OK       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FUTURO (1M imÃ³veis):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1 Tabela    â”‚
â”‚  ~15M itens  â”‚
â”‚  ~5GB        â”‚
â”‚              â”‚
â”‚  âš ï¸ Considerarâ”‚
â”‚  sharding    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ RESUMO EXECUTIVO

### âœ… O que vocÃª PRECISA saber:

1. **Uma tabela Ãºnica:** `kv_store_67caf26a`
2. **Chave = Prefixo + ID:** `acc_97239cad-4b8d-46c0-82a3-28673ae4cfc1`
3. **Valor = JSON completo:** Tudo sobre a entidade
4. **Busca por prefixo:** `getByPrefix('acc_')` para todos os imÃ³veis
5. **Isolamento por `organizationId`:** Multi-tenant seguro

### ğŸ“Š Entidades principais:

| Prefixo | Entidade | DescriÃ§Ã£o |
|---------|----------|-----------|
| `org_` | OrganizaÃ§Ãµes | Base multi-tenant |
| `acc_` | ImÃ³veis | Core do sistema |
| `res_` | Reservas | OcupaÃ§Ã£o |
| `user_` | UsuÃ¡rios | PermissÃµes |
| `chat_` | WhatsApp | Atendimento |

### ğŸ”„ Fluxo tÃ­pico:

1. Wizard cria imÃ³vel â†’ Salva estrutura aninhada
2. Backend normaliza â†’ Adiciona campos raiz
3. Cards leem â†’ Usam campos raiz (rÃ¡pido!)
4. Wizard edita â†’ Usa estrutura original (preservado!)

---

**VERSÃƒO:** v1.0.103.315  
**DATA:** 05/11/2025  
**MANTIDO POR:** Sistema RENDIZY
